<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PowerPlus Dashboard - Ultimate Edition</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
    .metric-card { transition: all 0.3s ease; }
    .metric-card:hover { transform: translateY(-4px); box-shadow: 0 12px 24px rgba(0,0,0,0.15); }
    .filter-btn { transition: all 0.2s; cursor: pointer; }
    .filter-btn.active { background: #6366f1; color: white; }
    .badge { padding: 2px 8px; border-radius: 9999px; font-size: 0.75rem; font-weight: 600; display: inline-block; }
    .badge-green { background: #d1fae5; color: #065f46; }
    .badge-yellow { background: #fef3c7; color: #92400e; }
    .badge-blue { background: #dbeafe; color: #1d4ed8; }
    .badge-red { background: #fee2e2; color: #991b1b; }
    .badge-purple { background: #ede9fe; color: #5b21b6; }
    
    .progress-bar { height: 8px; background: #e5e7eb; border-radius: 9999px; overflow: hidden; width: 120px; }
    .progress-fill { height: 100%; background: linear-gradient(to right, #10b981, #34d399); transition: width 0.5s ease-in-out; }
    
    .trust-score { padding: 4px 12px; border-radius: 9999px; font-weight: 600; display: inline-block; }
    .trust-1 { background: #fee2e2; color: #991b1b; }
    .trust-2 { background: #fed7aa; color: #9a3412; }
    .trust-3 { background: #fef3c7; color: #92400e; }
    .trust-4 { background: #d1fae5; color: #065f46; }
    .trust-5 { background: #a7f3d0; color: #064e3b; }

    .pipeline-prospect { background: #dbeafe; color: #1d4ed8; }
    .pipeline-contacted { background: #ede9fe; color: #5b21b6; }
    .pipeline-qualified { background: #fef3c7; color: #92400e; }
    .pipeline-meeting { background: #fef9c3; color: #78350f; }
    .pipeline-proposal { background: #d1fae5; color: #065f46; }
    .pipeline-negotiation { background: #a7f3d0; color: #064e3b; }
    .pipeline-deal { background: #4ade80; color: #064e3b; }

    .sortable { cursor: pointer; user-select: none; }
    .sortable:hover { background: #f3f4f6; }
    .sort-arrow { display: inline-block; margin-left: 4px; opacity: 0.3; }
    .sortable.asc .sort-arrow { opacity: 1; transform: rotate(0deg); }
    .sortable.desc .sort-arrow { opacity: 1; transform: rotate(180deg); }
</style>
</head>
<body class="bg-gray-50">

<div class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white py-6 px-8 shadow-lg">
    <div class="max-w-7xl mx-auto flex items-center justify-between">
        <div>
            <h1 class="text-3xl font-bold">PowerPlus Dashboard</h1>
            <p class="text-indigo-200 mt-1">German Market Director - Ultimate Edition</p>
        </div>
        <div class="text-right">
            <p class="text-sm text-indigo-200">Last Update</p>
            <p class="text-lg font-semibold" id="lastUpdate">-</p>
        </div>
    </div>
</div>

<div class="bg-white shadow-md sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-8">
        <div class="flex gap-1 overflow-x-auto py-2">
            <button onclick="switchTab('overview')" id="tab-overview" class="filter-btn active px-6 py-3 rounded-lg font-semibold whitespace-nowrap">ðŸ“Š Overview</button>
            <button onclick="switchTab('pipeline')" id="tab-pipeline" class="filter-btn px-6 py-3 rounded-lg font-semibold bg-gray-100 hover:bg-gray-200 whitespace-nowrap">ðŸŽ¯ Pipeline</button>
        </div>
    </div>
</div>

<div class="max-w-7xl mx-auto px-8 py-6">
    <!-- OVERVIEW TAB -->
    <div id="content-overview" class="tab-content">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
            <div class="bg-white rounded-xl shadow-lg p-6 metric-card">
                <div class="flex items-center justify-between mb-4">
                    <div>
                        <p class="text-sm text-gray-600">Active Pipeline</p>
                        <p class="text-3xl font-bold text-blue-600" id="metric-pipeline">0</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- PIPELINE TAB -->
    <div id="content-pipeline" class="tab-content hidden">
        <div class="bg-white rounded-xl shadow-lg p-6">
            <div class="flex justify-between items-center mb-6 flex-wrap gap-4">
                <h2 class="text-2xl font-bold text-gray-800">Sales Pipeline</h2>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full" id="pipeline-table">
                    <thead id="pipeline-thead"></thead>
                    <tbody id="pipeline-tbody"></tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
let allData = {};

const pipelineStages = ['Prospect','Contacted','Qualified','Meeting','Proposal','Negotiation','Deal Won'];
const stageClasses = {
    'Prospect':'pipeline-prospect',
    'Contacted':'pipeline-contacted',
    'Qualified':'pipeline-qualified',
    'Meeting':'pipeline-meeting',
    'Proposal':'pipeline-proposal',
    'Negotiation':'pipeline-negotiation',
    'Deal Won':'pipeline-deal'
};

// Load CSVs
async function loadCSV(file) {
    const resp = await fetch(file);
    const text = await resp.text();
    const lines = text.split('\n').filter(l => l.trim()!=='');
    const headers = lines[0].split(',');
    return lines.slice(1).map(line=>{
        const cols = line.split(',');
        let obj={};
        headers.forEach((h,i)=>obj[h.trim()]=cols[i]?.trim());
        return obj;
    });
}

async function loadAll() {
    allData.pipeline = await loadCSV('Pipeline.csv');
    renderPipeline();
    document.getElementById('metric-pipeline').textContent = allData.pipeline.length;
    document.getElementById('lastUpdate').textContent = new Date().toLocaleString('de-DE');
}

// Render pipeline table
function renderPipeline() {
    const thead = document.getElementById('pipeline-thead');
    const tbody = document.getElementById('pipeline-tbody');
    if(!allData.pipeline) return;

    const columns = Object.keys(allData.pipeline[0] || {});
    thead.innerHTML = '<tr class="bg-gray-50 text-left"><th class="px-4 py-3">Stage</th>'+columns.map(c=>`<th class="px-4 py-3">${c}</th>`).join('')+'</tr>';
    tbody.innerHTML = allData.pipeline.map(item=>{
        const stage = item['Stage'] || 'Prospect';
        const stageBadge = `<span class="badge ${stageClasses[stage] || 'badge-blue'}">${stage}</span>`;
        return `<tr class="border-t hover:bg-gray-50"><td class="px-4 py-3">${stageBadge}</td>`+columns.map(c=>{
            if(c==='Stage') return ''; 
            return `<td class="px-4 py-3">${item[c]||''}</td>`;
        }).join('')+'</tr>';
    }).join('');
}

// Tab switching
function switchTab(tab) {
    document.querySelectorAll('.tab-content').forEach(t=>t.classList.add('hidden'));
    document.getElementById('content-'+tab).classList.remove('hidden');
    document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'));
    document.getElementById('tab-'+tab).classList.add('active');
}

loadAll();
</script>
</body>
</html>
