<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PowerPlus Dashboard - Ultimate Edition</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { background-color: #f9fafb; }
.metric-card { transition: all 0.3s ease; }
.metric-card:hover { transform: translateY(-4px); box-shadow: 0 12px 24px rgba(0,0,0,0.15); }
.filter-btn { transition: all 0.2s; cursor: pointer; }
.filter-btn.active { background: #6366f1; color: white; }
.badge { padding: 2px 8px; border-radius: 9999px; font-size: 0.75rem; font-weight: 600; display: inline-block; }
.badge-green { background: #d1fae5; color: #065f46; }
.badge-yellow { background: #fef3c7; color: #92400e; }
.badge-blue { background: #dbeafe; color: #1d4ed8; }
.badge-red { background: #fee2e2; color: #991b1b; }
.badge-purple { background: #ede9fe; color: #5b21b6; }
.progress-bar { height: 8px; background: #e5e7eb; border-radius: 9999px; overflow: hidden; width: 120px; }
.progress-fill { height: 100%; background: linear-gradient(to right, #10b981, #34d399); transition: width 0.5s ease-in-out; }
.trust-score { padding: 4px 12px; border-radius: 9999px; font-weight: 600; display: inline-block; }
.trust-1 { background: #fee2e2; color: #991b1b; }
.trust-2 { background: #fed7aa; color: #9a3412; }
.trust-3 { background: #fef3c7; color: #92400e; }
.trust-4 { background: #d1fae5; color: #065f46; }
.trust-5 { background: #a7f3d0; color: #064e3b; }
.sortable { cursor: pointer; user-select: none; }
.sortable:hover { background: #f3f4f6; }
.sort-arrow { display: inline-block; margin-left: 4px; opacity: 0.3; }
.sortable.asc .sort-arrow { opacity: 1; transform: rotate(0deg); }
.sortable.desc .sort-arrow { opacity: 1; transform: rotate(180deg); }
.modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 999; align-items: center; justify-content: center; padding: 1rem; }
.modal.active { display: flex; }
.modal-content { background: white; border-radius: 1rem; max-width: 700px; width: 100%; max-height: 90vh; overflow-y: auto; padding: 2rem; }
input, select, textarea { width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb; border-radius: 0.5rem; margin-top: 0.5rem; }
input:focus, select:focus, textarea:focus { outline: none; border-color: #6366f1; }
textarea { min-height: 80px; }
.btn-primary { background: linear-gradient(135deg, #6366f1, #8b5cf6); color: white; padding: 0.75rem 1.5rem; border-radius: 0.5rem; font-weight: 600; cursor: pointer; transition: all 0.2s; border: none; }
.btn-primary:hover { transform: translateY(-2px); box-shadow: 0 8px 16px rgba(99,102,241,0.3); }
.btn-secondary { background: #f3f4f6; color: #374151; padding: 0.75rem 1.5rem; border-radius: 0.5rem; font-weight: 600; cursor: pointer; border: none; margin-left: 0.5rem; }
.btn-secondary:hover { background: #e5e7eb; }
.btn-danger { background: #ef4444; color: white; padding: 0.75rem 1.5rem; border-radius: 0.5rem; font-weight: 600; cursor: pointer; border: none; margin-left: 0.5rem; }
.btn-danger:hover { background: #dc2626; }
.btn-edit { background: #3b82f6; color: white; padding: 0.75rem 1.5rem; border-radius: 0.5rem; font-weight: 600; cursor: pointer; border: none; }
.btn-edit:hover { background: #2563eb; }
.btn-success { background: #10b981; color: white; padding: 0.75rem 1.5rem; border-radius: 0.5rem; font-weight: 600; cursor: pointer; border: none; margin-left: 0.5rem; }
.btn-success:hover { background: #059669; }
.action-bar { display: flex; gap: 0.5rem; flex-wrap: wrap; }
.column-list { max-height: 300px; overflow-y: auto; }
.column-item { padding: 0.5rem; border: 1px solid #e5e7eb; border-radius: 0.5rem; margin-bottom: 0.5rem; display: flex; justify-content: space-between; align-items: center; }
</style>
</head>
<body class="bg-gray-50">

<div class="max-w-7xl mx-auto px-8 py-6">
<h1 class="text-3xl font-bold mb-4">PowerPlus Dashboard - Ultimate Edition</h1>

<!-- Tabs -->
<div class="flex gap-1 overflow-x-auto py-2 mb-4">
<button onclick="switchTab('overview')" id="tab-overview" class="filter-btn active px-6 py-3 rounded-lg font-semibold whitespace-nowrap">Overview</button>
<button onclick="switchTab('pipeline')" id="tab-pipeline" class="filter-btn px-6 py-3 rounded-lg font-semibold bg-gray-100 whitespace-nowrap">Pipeline</button>
<button onclick="switchTab('candidates')" id="tab-candidates" class="filter-btn px-6 py-3 rounded-lg font-semibold bg-gray-100 whitespace-nowrap">Candidates</button>
<button onclick="switchTab('employers')" id="tab-employers" class="filter-btn px-6 py-3 rounded-lg font-semibold bg-gray-100 whitespace-nowrap">Employers</button>
<button onclick="switchTab('placements')" id="tab-placements" class="filter-btn px-6 py-3 rounded-lg font-semibold bg-gray-100 whitespace-nowrap">Placements</button>
<button onclick="switchTab('risk')" id="tab-risk" class="filter-btn px-6 py-3 rounded-lg font-semibold bg-gray-100 whitespace-nowrap">Risk</button>
<button onclick="switchTab('market')" id="tab-market" class="filter-btn px-6 py-3 rounded-lg font-semibold bg-gray-100 whitespace-nowrap">Market</button>
<button onclick="switchTab('training')" id="tab-training" class="filter-btn px-6 py-3 rounded-lg font-semibold bg-gray-100 whitespace-nowrap">Training</button>
</div>

<div id="content-area"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script>
// CSV files
const csvFiles = {
pipeline: 'Pipeline.csv',
candidates: 'Candidates.csv',
employers: 'Employers.csv',
placements: 'Placements.csv',
risk: 'Risk.csv',
market: 'Market.csv',
training: 'Training.csv'
};

let allData = {};
let columnConfig = {
pipeline: ['Company','Branch','Region','Stage','Priority','Azubi Bedarf','Phone','Last Contacted'],
candidates: ['Name','Branch','German Level','Overall Score','Status','Training Progress'],
employers: ['Company','Branch','Trust Score','Phone','Current PowerPlus Workers','Notes'],
placements: ['Candidate','Company','Branch','Start Date','End Date','Status'],
risk: ['Item','Type','Risk Level','Status'],
market: ['Branch','Vacancy Rate','Regional Demand','Priority Score'],
training: ['Module','Type','Duration','Status']
};

// load column config from localStorage
const savedConfig = localStorage.getItem('columnConfig');
if(savedConfig) columnConfig = JSON.parse(savedConfig);

function saveColumnConfig(){ localStorage.setItem('columnConfig',JSON.stringify(columnConfig)); }

function loadCSV(name){
return new Promise(resolve=>{
Papa.parse(csvFiles[name],{
download:true,header:true,skipEmptyLines:true,
complete:function(results){ resolve(results.data); }
});
});
}

async function loadAllData(){
for(let key in csvFiles){
allData[key]=await loadCSV(key);
}
renderTables();
}

function switchTab(tab){
document.querySelectorAll('.tab-content').forEach(tc=>tc.remove());
let container=document.getElementById('content-area');
let div=document.createElement('div'); div.id='content-'+tab; div.className='tab-content';
div.innerHTML=`<div class="overflow-x-auto"><table class="w-full" id="${tab}-table"><thead></thead><tbody></tbody></table></div>`;
container.appendChild(div);
renderTable(tab);
document.querySelectorAll('.filter-btn').forEach(btn=>btn.classList.remove('active'));
document.getElementById('tab-'+tab).classList.add('active');
}

function renderTables(){ for(let key in allData) renderTable(key); }

function renderTable(collection){
const table=document.getElementById(collection+'-table');
if(!table) return;
const thead=table.querySelector('thead');
const tbody=table.querySelector('tbody');
thead.innerHTML='';
tbody.innerHTML='';
let columns=columnConfig[collection]||[];
thead.innerHTML='<tr><th>#</th>'+columns.map(c=>`<th>${c}</th>`).join('')+'</tr>';
(allData[collection]||[]).forEach((row,i)=>{
let tr=document.createElement('tr');
tr.innerHTML=`<td>${i+1}</td>`+columns.map(c=>{
let val=row[c]||'-';
if(c==='Stage'||c==='Priority'||c==='Status'||c==='Risk Level'){
let color='blue';
if(val==='High'||val==='Ready') color='green';
else if(val==='Medium'||val==='Training') color='yellow';
else if(val==='Low'||val==='Screening') color='blue';
else color='purple';
val=`<span class="badge badge-${color}">${val}</span>`;
}
if(c==='Training Progress'){
let progress=parseInt(val.replace('%',''))||0;
val=`<div class="progress-bar"><div class="progress-fill" style="width:${progress}%"></div></div>`;
}
if(c==='Trust Score'){
let score=parseFloat(val)||0;
let cls=score>=4.5?'trust-5':score>=3.5?'trust-4':score>=2.5?'trust-3':score>=1.5?'trust-2':'trust-1';
val=`<span class="trust-score ${cls}">${score.toFixed(1)}</span>`;
}
return `<td>${val}</td>`;
}).join('');
tbody.appendChild(tr);
});
}

// Initial load
loadAllData();
switchTab('overview');
</script>
</body>
</html>
