<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PowerPlus Dashboard - Ultimate Edition</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
/* Alle Styles unverändert wie in deinem Original plus kleine Anpassungen für Drag & Drop */
.metric-card { transition: all 0.3s ease; }
.metric-card:hover { transform: translateY(-4px); box-shadow: 0 12px 24px rgba(0,0,0,0.15); }
.filter-btn { transition: all 0.2s; cursor: pointer; }
.filter-btn.active { background: #6366f1; color: white; }
.badge { padding: 2px 8px; border-radius: 9999px; font-size: 0.75rem; font-weight: 600; display: inline-block; }
.badge-green { background: #d1fae5; color: #065f46; }
.badge-yellow { background: #fef3c7; color: #92400e; }
.badge-blue { background: #dbeafe; color: #1d4ed8; }
.badge-red { background: #fee2e2; color: #991b1b; }
.badge-purple { background: #ede9fe; color: #5b21b6; }
.progress-bar { height: 8px; background: #e5e7eb; border-radius: 9999px; overflow: hidden; width: 120px; }
.progress-fill { height: 100%; background: linear-gradient(to right, #10b981, #34d399); transition: width 0.5s ease-in-out; }
.trust-score { padding: 4px 12px; border-radius: 9999px; font-weight: 600; display: inline-block; }
.trust-1 { background: #fee2e2; color: #991b1b; }
.trust-2 { background: #fed7aa; color: #9a3412; }
.trust-3 { background: #fef3c7; color: #92400e; }
.trust-4 { background: #d1fae5; color: #065f46; }
.trust-5 { background: #a7f3d0; color: #064e3b; }
.sortable { cursor: pointer; user-select: none; }
.sortable:hover { background: #f3f4f6; }
.sort-arrow { display: inline-block; margin-left: 4px; opacity: 0.3; }
.sortable.asc .sort-arrow { opacity: 1; transform: rotate(0deg); }
.sortable.desc .sort-arrow { opacity: 1; transform: rotate(180deg); }
.modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 999; align-items: center; justify-content: center; padding: 1rem; }
.modal.active { display: flex; }
.modal-content { background: white; border-radius: 1rem; max-width: 700px; width: 100%; max-height: 90vh; overflow-y: auto; padding: 2rem; }
input, select, textarea { width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb; border-radius: 0.5rem; margin-top: 0.5rem; }
input:focus, select:focus, textarea:focus { outline: none; border-color: #6366f1; }
textarea { min-height: 80px; }
.btn-primary { background: linear-gradient(135deg, #6366f1, #8b5cf6); color: white; padding: 0.75rem 1.5rem; border-radius: 0.5rem; font-weight: 600; cursor: pointer; transition: all 0.2s; border: none; }
.btn-primary:hover { transform: translateY(-2px); box-shadow: 0 8px 16px rgba(99,102,241,0.3); }
.btn-secondary { background: #f3f4f6; color: #374151; padding: 0.75rem 1.5rem; border-radius: 0.5rem; font-weight: 600; cursor: pointer; border: none; margin-left: 0.5rem; }
.btn-secondary:hover { background: #e5e7eb; }
.btn-danger { background: #ef4444; color: white; padding: 0.75rem 1.5rem; border-radius: 0.5rem; font-weight: 600; cursor: pointer; border: none; margin-left: 0.5rem; }
.btn-danger:hover { background: #dc2626; }
.btn-edit { background: #3b82f6; color: white; padding: 0.75rem 1.5rem; border-radius: 0.5rem; font-weight: 600; cursor: pointer; border: none; }
.btn-edit:hover { background: #2563eb; }
.btn-success { background: #10b981; color: white; padding: 0.75rem 1.5rem; border-radius: 0.5rem; font-weight: 600; cursor: pointer; border: none; margin-left: 0.5rem; }
.btn-success:hover { background: #059669; }
.action-bar { display: flex; gap: 0.5rem; flex-wrap: wrap; }
.column-list { max-height: 300px; overflow-y: auto; }
.column-item { padding: 0.5rem; border: 1px solid #e5e7eb; border-radius: 0.5rem; margin-bottom: 0.5rem; display: flex; justify-content: space-between; align-items: center; cursor: grab; }
</style>
</head>
<body class="bg-gray-50">

<div class="max-w-7xl mx-auto px-8 py-6">
<h1 class="text-3xl font-bold mb-4">PowerPlus Dashboard - Ultimate Edition</h1>
<div id="lastUpdate" class="mb-6 text-sm text-gray-500">-</div>

<div id="overview-metrics" class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6"></div>

<div class="overflow-x-auto mb-6">
<table id="pipeline-table" class="w-full border-collapse">
<thead></thead>
<tbody></tbody>
</table>
</div>

<div class="overflow-x-auto mb-6">
<table id="candidates-table" class="w-full border-collapse">
<thead></thead>
<tbody></tbody>
</table>
</div>
</div>

<script>
// Alle CSV-Dateien im selben Ordner
const collections = ['pipeline','candidates','employers','placements','risk','market','training'];
let allData = {};
let columnConfig = {
pipeline: ['Company','Branch','Region','Stage','Priority','Azubi Bedarf','Phone','Last Contacted'],
candidates: ['Name','Branch','German Level','Overall Score','Status','Training Progress'],
employers: ['Company','Branch','Trust Score','Phone','Current PowerPlus Workers','Notes'],
placements: ['Candidate','Company','Branch','Start Date','End Date','Status'],
risk: ['Item','Type','Risk Level','Status'],
market: ['Branch','Vacancy Rate','Regional Demand','Priority Score'],
training: ['Module','Type','Duration','Status']
};

// Load column config from localStorage
const savedConfig = localStorage.getItem('columnConfig');
if(savedConfig) columnConfig = JSON.parse(savedConfig);

function fetchCSV(name){ return fetch(name+'.csv').then(r=>r.text()).then(t=>t.split('\n').map(l=>l.split(','))); }

async function loadAllCSV(){
for(const coll of collections){
let data = await fetchCSV(coll);
const headers = data.shift();
allData[coll] = data.map(row=>{
let obj={}; row.forEach((v,i)=>obj[headers[i]]=v); return obj;
});
renderTable(coll);
updateMetrics();
}
document.getElementById('lastUpdate').textContent=new Date().toLocaleString('de-DE');
}

function renderTable(collection){
const table=document.getElementById(collection+'-table');
if(!table) return;
const thead=table.querySelector('thead'); const tbody=table.querySelector('tbody');
const columns=columnConfig[collection];
thead.innerHTML='<tr>'+columns.map(c=>`<th class="px-2 py-1 border">${c}</th>`).join('')+'</tr>';
tbody.innerHTML=allData[collection].map(row=>'<tr>'+columns.map(c=>`<td class="px-2 py-1 border">${row[c]||'-'}</td>`).join('')+'</tr>').join('');
}

function updateMetrics(){
document.getElementById('overview-metrics').innerHTML=`<div class="bg-white p-4 rounded shadow">Pipeline: ${allData.pipeline.length}</div>
<div class="bg-white p-4 rounded shadow">Candidates Ready: ${allData.candidates.filter(c=>c.Status==='Ready').length}</div>
<div class="bg-white p-4 rounded shadow">Placements This Month: ${allData.placements.filter(p=>{const d=new Date(p['Start Date']);return d.getMonth()===new Date().getMonth()&&d.getFullYear()===new Date().getFullYear();}).length}</div>
<div class="bg-white p-4 rounded shadow">High Risk: ${allData.risk.filter(r=>r['Risk Level']==='High').length}</div>`;
}

// Drag & Drop für Spalten
function makeDraggable(){
document.querySelectorAll('.column-item').forEach(item=>{
item.draggable=true;
item.addEventListener('dragstart',e=>e.dataTransfer.setData('text/plain',item.textContent));
});
}

// initial load
loadAllCSV();
</script>
</body>
</html>
