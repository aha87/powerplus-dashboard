<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PowerPlus Dashboard - Ultimate Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore-compat.js"></script>
    <style>
        .metric-card { transition: all 0.3s ease; }
        .metric-card:hover { transform: translateY(-4px); box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        .filter-btn { transition: all 0.2s; cursor: pointer; }
        .filter-btn.active { background: #6366f1 !important; color: white !important; }
        .sortable { cursor: pointer; user-select: none; }
        .sortable:hover { background: #f3f4f6; }
        .sortable.asc::after { content: ' ‚Üë'; }
        .sortable.desc::after { content: ' ‚Üì'; }
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 9999; align-items: center; justify-content: center; padding: 1rem; }
        .modal.active { display: flex; }
        .modal-content { background: white; border-radius: 1rem; max-width: 700px; width: 100%; max-height: 90vh; overflow-y: auto; padding: 2rem; }
        input, select, textarea { width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb; border-radius: 0.5rem; margin-top: 0.5rem; box-sizing: border-box; }
        input:focus, select:focus, textarea:focus { outline: none; border-color: #6366f1; }
        .btn { padding: 0.75rem 1.5rem; border-radius: 0.5rem; font-weight: 600; cursor: pointer; border: none; transition: all 0.2s; }
        .btn-primary { background: #6366f1; color: white; }
        .btn-primary:hover { background: #4f46e5; }
        .btn-success { background: #10b981; color: white; }
        .btn-success:hover { background: #059669; }
        .btn-edit { background: #3b82f6; color: white; }
        .btn-edit:hover { background: #2563eb; }
        .btn-danger { background: #ef4444; color: white; }
        .btn-danger:hover { background: #dc2626; }
        .stage-prospect    { background: #9CA3AF; color: white; }
        .stage-contacted   { background: #60A5FA; color: white; }
        .stage-qualified   { background: #2563EB; color: white; }
        .stage-meeting     { background: #7C3AED; color: white; }
        .stage-proposal    { background: #F59E0B; color: white; }
        .stage-negotiation { background: #EF4444; color: white; }
        .stage-dealwon     { background: #10B981; color: white; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">

    <!-- Header -->
    <div class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white py-6 px-8 shadow-lg">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <div>
                <h1 class="text-3xl font-bold">PowerPlus Dashboard</h1>
                <p class="text-indigo-200 mt-1">German Market Director - Ultimate Edition</p>
            </div>
            <div class="text-right">
                <p class="text-sm text-indigo-200">Last Update</p>
                <p class="text-lg font-semibold" id="lastUpdate">-</p>
            </div>
        </div>
    </div>

    <!-- Tabs -->
    <div class="bg-white shadow-md sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-8">
            <div class="flex gap-1 overflow-x-auto py-2">
                <button onclick="switchTab('overview')" id="tab-overview" class="filter-btn active px-6 py-3 rounded-lg font-semibold whitespace-nowrap">üìä Overview</button>
                <button onclick="switchTab('pipeline')" id="tab-pipeline" class="filter-btn px-6 py-3 rounded-lg font-semibold bg-gray-100 hover:bg-gray-200 whitespace-nowrap">üéØ Pipeline</button>
                <button onclick="switchTab('employers')" id="tab-employers" class="filter-btn px-6 py-3 rounded-lg font-semibold bg-gray-100 hover:bg-gray-200 whitespace-nowrap">ü§ù Employers</button>
                <button onclick="switchTab('candidates')" id="tab-candidates" class="filter-btn px-6 py-3 rounded-lg font-semibold bg-gray-100 hover:bg-gray-200 whitespace-nowrap">‚≠ê Candidates</button>
                <button onclick="switchTab('placements')" id="tab-placements" class="filter-btn px-6 py-3 rounded-lg font-semibold bg-gray-100 hover:bg-gray-200 whitespace-nowrap">‚úÖ Placements</button>
                <button onclick="switchTab('risk')" id="tab-risk" class="filter-btn px-6 py-3 rounded-lg font-semibold bg-gray-100 hover:bg-gray-200 whitespace-nowrap">üõ°Ô∏è Risk</button>
                <button onclick="switchTab('market')" id="tab-market" class="filter-btn px-6 py-3 rounded-lg font-semibold bg-gray-100 hover:bg-gray-200 whitespace-nowrap">üó∫Ô∏è Market</button>
                <button onclick="switchTab('training')" id="tab-training" class="filter-btn px-6 py-3 rounded-lg font-semibold bg-gray-100 hover:bg-gray-200 whitespace-nowrap">üìö Training</button>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-8 py-6">

        <!-- Overview -->
        <div id="content-overview" class="tab-content">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="bg-white rounded-xl shadow p-6 metric-card">
                    <p class="text-sm text-gray-600">Active Pipeline</p>
                    <p class="text-3xl font-bold text-blue-600 mt-1" id="metric-pipeline">0</p>
                </div>
                <div class="bg-white rounded-xl shadow p-6 metric-card">
                    <p class="text-sm text-gray-600">Employers</p>
                    <p class="text-3xl font-bold text-green-600 mt-1" id="metric-employers">0</p>
                </div>
                <div class="bg-white rounded-xl shadow p-6 metric-card">
                    <p class="text-sm text-gray-600">Candidates</p>
                    <p class="text-3xl font-bold text-indigo-600 mt-1" id="metric-candidates">0</p>
                </div>
                <div class="bg-white rounded-xl shadow p-6 metric-card">
                    <p class="text-sm text-gray-600">Placements</p>
                    <p class="text-3xl font-bold text-purple-600 mt-1" id="metric-placements">0</p>
                </div>
            </div>
            <p class="text-center text-gray-500">Weitere Charts und Metriken folgen...</p>
        </div>

        <!-- Pipeline -->
        <div id="content-pipeline" class="tab-content hidden">
            <div class="bg-white rounded-xl shadow-lg p-6">
                <div class="flex justify-between items-center mb-6 flex-wrap gap-4">
                    <h2 class="text-2xl font-bold text-gray-800">Sales Pipeline</h2>
                    <div class="flex gap-2 flex-wrap">
                        <button onclick="filterPipeline('all')" id="filter-pipeline-all" class="filter-btn active px-4 py-2 rounded text-sm font-semibold bg-indigo-600 text-white">All</button>
                        <button onclick="filterPipeline('Pflege')" id="filter-pipeline-Pflege" class="filter-btn px-4 py-2 rounded text-sm font-semibold bg-gray-100">Pflege</button>
                        <button onclick="filterPipeline('Handwerk')" id="filter-pipeline-Handwerk" class="filter-btn px-4 py-2 rounded text-sm font-semibold bg-gray-100">Handwerk</button>
                        <button onclick="filterPipeline('Gastro')" id="filter-pipeline-Gastro" class="filter-btn px-4 py-2 rounded text-sm font-semibold bg-gray-100">Gastro</button>
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full" id="pipeline-table">
                        <thead id="pipeline-thead"></thead>
                        <tbody id="pipeline-tbody"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Employers -->
        <div id="content-employers" class="tab-content hidden">
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">Employers</h2>
                <div class="overflow-x-auto">
                    <table class="w-full" id="employers-table">
                        <thead id="employers-thead"></thead>
                        <tbody id="employers-tbody"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Andere Tabs (Platzhalter) -->
        <div id="content-candidates" class="tab-content hidden"><div class="bg-white rounded-xl shadow-lg p-6"><h2 class="text-2xl font-bold">Candidates</h2><p class="mt-4 text-gray-600">Keine Daten vorhanden oder noch nicht implementiert.</p></div></div>
        <div id="content-placements" class="tab-content hidden"><div class="bg-white rounded-xl shadow-lg p-6"><h2 class="text-2xl font-bold">Placements</h2><p class="mt-4 text-gray-600">Keine Daten vorhanden oder noch nicht implementiert.</p></div></div>
        <div id="content-risk" class="tab-content hidden"><div class="bg-white rounded-xl shadow-lg p-6"><h2 class="text-2xl font-bold">Risk</h2><p class="mt-4 text-gray-600">Keine Daten vorhanden oder noch nicht implementiert.</p></div></div>
        <div id="content-market" class="tab-content hidden"><div class="bg-white rounded-xl shadow-lg p-6"><h2 class="text-2xl font-bold">Market</h2><p class="mt-4 text-gray-600">Keine Daten vorhanden oder noch nicht implementiert.</p></div></div>
        <div id="content-training" class="tab-content hidden"><div class="bg-white rounded-xl shadow-lg p-6"><h2 class="text-2xl font-bold">Training</h2><p class="mt-4 text-gray-600">Keine Daten vorhanden oder noch nicht implementiert.</p></div></div>

    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyA1WKOUlVF1YvBMolSVACHOXz2kGQ_a6Sc",
            authDomain: "powerplus-dashboard.firebaseapp.com",
            projectId: "powerplus-dashboard",
            storageBucket: "powerplus-dashboard.firebasestorage.app",
            messagingSenderId: "506858654374",
            appId: "1:506858654374:web:06e47ff0cd5f8ae7808267",
            measurementId: "G-H1BJQBB3KP"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        let dataCache = {};
        let filterPipelineBranch = 'all';

        const stageClasses = {
            'Prospect': 'stage-prospect',
            'Contacted': 'stage-contacted',
            'Qualified': 'stage-qualified',
            'Meeting': 'stage-meeting',
            'Proposal': 'stage-proposal',
            'Negotiation': 'stage-negotiation',
            'Deal Won': 'stage-dealwon'
        };

        function loadCollection(collectionName) {
            db.collection(collectionName).onSnapshot(snapshot => {
                dataCache[collectionName] = snapshot.docs.map(doc => ({id: doc.id, ...doc.data()}));
                if (collectionName === 'pipeline') renderPipeline();
                if (collectionName === 'employers') renderEmployers();
                updateMetrics();
            }, err => {
                console.error(`Error loading ${collectionName}:`, err);
            });
        }

        function updateMetrics() {
            document.getElementById('metric-pipeline').textContent = (dataCache.pipeline || []).length;
            document.getElementById('metric-employers').textContent = (dataCache.employers || []).length;
            document.getElementById('metric-candidates').textContent = (dataCache.candidates || []).length || 0;
            document.getElementById('metric-placements').textContent = (dataCache.placements || []).length || 0;
            document.getElementById('lastUpdate').textContent = new Date().toLocaleString('de-DE');
        }

        function renderPipeline() {
            const thead = document.getElementById('pipeline-thead');
            const tbody = document.getElementById('pipeline-tbody');

            thead.innerHTML = `
                <tr class="bg-gray-50 text-left border-b">
                    <th class="px-6 py-4 font-semibold">Company</th>
                    <th class="px-6 py-4 font-semibold">Branch</th>
                    <th class="px-6 py-4 font-semibold">Stage</th>
                </tr>
            `;

            let rows = '';
            let items = dataCache.pipeline || [];
            if (filterPipelineBranch !== 'all') {
                items = items.filter(i => i.Branch === filterPipelineBranch);
            }

            if (items.length === 0) {
                rows = '<tr><td colspan="3" class="text-center py-12 text-gray-500">Keine Eintr√§ge</td></tr>';
            } else {
                items.forEach(item => {
                    const stageCls = stageClasses[item.Stage] || 'bg-gray-200 text-gray-800';
                    const stage = item.Stage ? `<span class="${stageCls} px-3 py-1 rounded-full text-sm font-medium">${item.Stage}</span>` : '-';
                    rows += `
                        <tr class="border-b hover:bg-gray-50">
                            <td class="px-6 py-4">${item.Company || '-'}</td>
                            <td class="px-6 py-4">${item.Branch || '-'}</td>
                            <td class="px-6 py-4">${stage}</td>
                        </tr>
                    `;
                });
            }
            tbody.innerHTML = rows;
        }

        function renderEmployers() {
            const thead = document.getElementById('employers-thead');
            const tbody = document.getElementById('employers-tbody');

            thead.innerHTML = `
                <tr class="bg-gray-50 text-left border-b">
                    <th class="px-6 py-4 font-semibold">Company</th>
                    <th class="px-6 py-4 font-semibold">Branch</th>
                    <th class="px-6 py-4 font-semibold">Phone</th>
                </tr>
            `;

            let rows = '';
            (dataCache.employers || []).forEach(item => {
                rows += `
                    <tr class="border-b hover:bg-gray-50">
                        <td class="px-6 py-4">${item.Company || '-'}</td>
                        <td class="px-6 py-4">${item.Branch || '-'}</td>
                        <td class="px-6 py-4">${item.Phone || '-'}</td>
                    </tr>
                `;
            });
            if (rows === '') rows = '<tr><td colspan="3" class="text-center py-12 text-gray-500">Keine Eintr√§ge</td></tr>';
            tbody.innerHTML = rows;
        }

        function filterPipeline(branch) {
            filterPipelineBranch = branch;
            ['all', 'Pflege', 'Handwerk', 'Gastro'].forEach(b => {
                const btn = document.getElementById(`filter-pipeline-${b}`);
                if (btn) {
                    const active = b === branch;
                    btn.classList.toggle('active', active);
                    btn.classList.toggle('bg-indigo-600', active);
                    btn.classList.toggle('text-white', active);
                    btn.classList.toggle('bg-gray-100', !active);
                }
            });
            renderPipeline();
        }

        function switchTab(tab) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.add('hidden'));
            document.getElementById('content-' + tab).classList.remove('hidden');

            document.querySelectorAll('[id^="tab-"]').forEach(b => {
                b.classList.remove('active', 'bg-indigo-600', 'text-white');
                b.classList.add('bg-gray-100');
            });
            document.getElementById('tab-' + tab).classList.add('active', 'bg-indigo-600', 'text-white');
            document.getElementById('tab-' + tab).classList.remove('bg-gray-100');
        }

        // Init
        window.onload = () => {
            ['pipeline', 'employers', 'candidates', 'placements', 'risk', 'market', 'training'].forEach(loadCollection);
            switchTab('pipeline');
            updateMetrics();
        };
    </script>
</body>
</html>
